@using Client.Models.ViewModels
@model SideBarViewModel


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link href="~/css/default.css" rel="stylesheet" />
    <!-- Bootstrap core CSS -->
    <link href="~/assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="~/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/assets/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="~/assets/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/lineicons/style.css">

    <!-- Custom styles for this template -->
    <link href="~/assets/css/style.css" rel="stylesheet">
    <link href="~/assets/css/style-responsive.css" rel="stylesheet">

    <script src="~/assets/js/chart-master/Chart.js"></script>


</head>

<body>

    <section id="container">

        <header class="header black-bg">
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars tooltips" data-placement="right"></div>
            </div>
            <div class="top-menu">
                <ul class="nav pull-right top-menu">
                    <li>
                        <div id="header_inbox_bar" class="dropdown">
                            <a id="dropdownToggle" class="dropdown-toggle" href="javascript:void(0);">
                                <i class="fa fa-envelope-o"></i>
                                <span class="badge bg-theme">5</span>
                            </a>
                            <ul id="dropdownMenu" class="dropdown-menu extended inbox">
                                <div class="notify-arrow notify-arrow-green"></div>
                                <li>
                                    <p class="green">Yeni mesajınız var</p>
                                </li>
                                <li>

                                    <a href="index.html#">
                                        <span class="subject">
                                            <span class="from">Zac Snider</span>
                                            <span class="time">Just now</span>
                                        </span>
                                        <span class="message">
                                            Hi mate, how is everything?
                                        </span>
                                    </a>
                                </li>
                             
                                <li>
                                    <a href="index.html#">See all messages</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li><a class="logout" href="/Exit/Index">Çıkış</a></li>
                </ul>
            </div>
        </header>


        <!--header end-->
        <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
        <!--sidebar start-->
        <aside>
            <div id="sidebar" class="nav-collapse ">
                <!-- sidebar menu start-->
                <ul class="sidebar-menu" id="nav-accordion">


                    @if (Model.RoleId == "5")
                    {
                        <h5 class="centered">Müdür</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="sub-menu">
                            <a class="active">
                                <i class="fa fa-desktop"></i>
                                <span>Stok Yönetimi</span>
                            </a>

                            <ul class="sub">
                                <li><a href="/Stock/Index">Stok </a></li>
                                <li><a href="/StockMovement/WaitingStatuses">Stok Onay </a></li>
                                <li><a href="/StockMovement/Index">Stok Hareketleri</a></li>
                                <li><a href="/Product/Index">Ürünler</a></li>
                                <li><a href="/Category/Index">Kategoriler</a></li>

                            </ul>
                        </li>
                        <li class="sub-menu">
                            <a href="/WareHouse/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Depo Yönetimi</span>
                            </a>
                        </li>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Sohbet</span>
                            </a>
                            <ul class="sub">
                                <li><a href="/Messages/Index">Mesaj Gönder</a></li>
                            </ul>
                        </li>
                    }
                    @if (Model.RoleId == "1")
                    {
                        <h5 class="centered">Admin</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Sohbet</span>
                            </a>
                            <ul class="sub">
                                <li><a href="/GroupChat/Index">Sohbet Ayarları </a></li>
                                <li><a href="/Messages/Index">Mesaj Gönder</a></li>                             
                            </ul>
                        </li>


                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Kullanıcı Yönetimi</span>
                            </a>
                        </li>

                        <li class="sub-menu">
                            <a href="/UserRole/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Rol Yönetimi</span>
                            </a>
                        </li>
                    }

                    @if (Model.RoleId == "3")
                    {
                        <h5 class="centered">Satış Elemanı</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/SaleDetails/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Ürün Satış Paneli</span>
                            </a>
                        </li>
                    }

                    @if (Model.RoleId == "2")
                    {
                        <h5 class="centered">Satın Alma</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="mt">
                            <a class="active" href="/Supplier/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Tedarikçiler</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/Demand/WaitingDemands">
                                <i class="fa fa-dashboard"></i>
                                <span>Talep Onay</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/Demand/ApprovedDemands">
                                <i class="fa fa-dashboard"></i>
                                <span>Onaylanmış Talepler</span>
                            </a>
                        </li>

                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Sohbet</span>
                            </a>
                            <ul class="sub">
                                <li><a href="/Messages/Index">Mesaj Gönder</a></li>
                            </ul>
                        </li>
                    }
                    @if (Model.RoleId == "4")
                    {
                        <h5 class="centered">Depo Sorumlusu</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="mt">
                            <a class="active" href="/Demand/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Talep Oluştur</span>
                            </a>
                        </li>

                        <li class="sub-menu">
                            <a class="active">
                                <i class="fa fa-desktop"></i>
                                <span>Stok Yönetimi</span>
                            </a>

                            <ul class="sub">
                                <li><a href="/Stock/Index">Stok </a></li>
                                <li><a href="/Product/Index">Ürünler</a></li>
                                <li><a href="/Category/Index">Kategoriler</a></li>

                            </ul>
                        </li>
                        <li class="sub-menu">
                            <a href="/Messages/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                    }
                </ul>

            </div>
        </aside>


        <!--footer start-->
       @*  <footer class="footer">
            <div class="chatbox-holder">
                <div class="chatbox">
                    <div class="chatbox-top">
                        <div class="chat-partner-name">
                            <span class="status online"></span>
                            <div class="chat-partner-name-content">
                                <h3>@Model.UserGetDto.Name</h3>
                            </div>
                        </div>
                        <div class="chatbox-icons">
                            <a href="javascript:void(0);"><i class="fa fa-minus"></i></a>
                            <a href="javascript:void(0);"><i class="fa fa-close"></i></a>
                        </div>
                    </div>
                    @foreach (var item in Model.GetChats)
                    {
                        <div class="message-box-holder">
                            <div class="message-sender">
                                @item.UserName
                            </div>
                            <div class="message-box message-partner">
                                @item.MessageText
                            </div>
                        </div>
                    }

                    <div class="chat-input-holder">
                        <textarea id="chat-input"></textarea>
                        <input type="submit" value="Send" id="message-send" />
                    </div>
                    <div class="attachment-panel">
                        <a href="#" class="fa fa-thumbs-up"></a>
                        <a href="#" class="fa fa-camera"></a>
                        <a href="#" class="fa fa-video-camera"></a>
                        <a href="#" class="fa fa-image"></a>
                        <a href="#" class="fa fa-paperclip"></a>
                        <a href="#" class="fa fa-link"></a>
                        <a href="#" class="fa fa-trash-o"></a>
                        <a href="#" class="fa fa-search"></a>
                    </div>
                </div>
            </div>
        </footer> *@


    </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="~/assets/js/jquery.js"></script>
    <script src="~/assets/js/jquery-1.8.3.min.js"></script>
    <script src="~/assets/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="~/assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="~/assets/js/jquery.scrollTo.min.js"></script>
    <script src="~/assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="~/assets/js/jquery.sparkline.js"></script>


    <!--common script for all pages-->
    <script src="~/assets/js/common-scripts.js"></script>

    <script type="text/javascript" src="~/assets/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="~/assets/js/gritter-conf.js"></script>

    <!--script for this page-->
    <script src="~/assets/js/sparkline-chart.js"></script>
    <script src="~/assets/js/zabuto_calendar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.3/signalr.min.js"></script>
    <script type="application/javascript">

        function myNavFunction(id) {
            $("#date-popover").hide();
            var nav = $("#" + id).data("navigation");
            var to = $("#" + id).data("to");
            console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
        }

    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var dropdownToggle = document.getElementById('dropdownToggle');
            var dropdownMenu = document.getElementById('dropdownMenu');

            if (dropdownToggle && dropdownMenu) {
                dropdownToggle.addEventListener('click', function () {
                    dropdownMenu.classList.toggle('show');
                });

                // Close the dropdown if the user clicks outside of it
                window.addEventListener('click', function (event) {
                    if (!dropdownToggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
                        dropdownMenu.classList.remove('show');
                    }
                });
            }
        });

        // $(document).ready(function () {
        //     $.ajax({
        //         url: '/Chat/GetUnreadMessages',
        //         method: 'GET',
        //         success: function (data) {
        //             const unreadMessages = data;
        //             const unreadCount = unreadMessages.length;

        //             $('#header_inbox_bar .badge').text(unreadCount);

        //             const dropdownMenu = $('#dropdownMenu');
        //             dropdownMenu.empty();

        //             if (unreadCount > 0) {
        //                 dropdownMenu.append('<div class="notify-arrow notify-arrow-green"></div>');
        //                 dropdownMenu.append(`<li><p class="green">You have ${unreadCount} new messages</p></li>`);

        //                 unreadMessages.forEach(message => {
        //                     dropdownMenu.append(`
        //                             <li>
        //                                 <a href="index.html#">
        //                                     <span class="photo"><img alt="avatar" src="assets/img/ui-zac.jpg"></span>
        //                                     <span class="subject">
        //                                         <span class="from">${message.userName}</span>
        //                                         <span class="time">${message.timeSent}</span>
        //                                     </span>
        //                                     <span class="message">${message.messageText}</span>
        //                                 </a>
        //                             </li>
        //                         `);
        //                 });

        //                 dropdownMenu.append('<li><a href="index.html#">See all messages</a></li>');
        //             } else {
        //                 dropdownMenu.append('<li><p class="green">You have no new messages</p></li>');
        //             }
        //         },
        //         error: function (error) {
        //             console.error('Error fetching unread messages:', error);
        //         }
        //     });
        // });

        $(function () {
            $('.fa-minus').click(function () {
                $(this).closest('.chatbox').toggleClass('chatbox-min');
            });
            $('.fa-close').click(function () {
                $(this).closest('.chatbox').hide();
            });
        });

        // const user = "@Model.UserGetDto.Name";
        // const senderId = @Model.UserGetDto.Id;
        // const connection = new signalR.HubConnectionBuilder()
        //     .withUrl("https://localhost:7220/chatHub")
        //     .configureLogging(signalR.LogLevel.Debug)
        //     .build();

        // connection.on("ReceiveMessage", function (user, message) {
        //     const alertDiv = document.createElement("div");
        //     alertDiv.classList.add("alert", "alert-dark");
        //     alertDiv.setAttribute("role", "alert");

        //     const messageParagraph = document.createElement("p");

        //     const boldUserName = document.createElement("b");
        //     boldUserName.textContent = decodeURIComponent(user);

        //     messageParagraph.appendChild(boldUserName);
        //     messageParagraph.appendChild(document.createTextNode(": " + decodeURIComponent(message)));

        //     alertDiv.appendChild(messageParagraph);

        //     document.getElementById("mesajAlani").appendChild(alertDiv);
        // });

        // connection.start().catch(function (err) {
        //     console.error(err.toString());
        // });

        // document.getElementById("message-send").addEventListener("click", function (event) {
        //     event.preventDefault();

        //     const message = document.getElementById("chat-input").value;
        //     if (!message) {
        //         console.error('Mesaj boş olamaz.');
        //         return;
        //     }

        //     const data = { user: user,senderId, message: message };
        //     const queryString = new URLSearchParams(data).toString();

        //     console.log('Sending data:', data);

        //     const url = 'https://localhost:7220/api/Chats?' + queryString;
        //     fetch(url, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //             //token'ı buraya eklersin
        //         },
              
        //     }).then(response => {
        //         if (response.ok) {
        //             console.log('Mesaj gönderildi ve kaydedildi.');
        //         } else {
        //             return response.json().then(err => {
        //                 console.error('Mesaj gönderilemedi:', err);
        //             });
        //         }
        //     }).catch(error => {
        //         console.error('Hata:', error);
        //     });
        // });
    </script>

</body>
</html>
