@using Client.Models.ViewModels
@model SideBarViewModel


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <!-- Bootstrap core CSS -->
    <link href="~/assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="~/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/assets/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="~/assets/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/lineicons/style.css">

    <!-- Custom styles for this template -->
    <link href="~/assets/css/style.css" rel="stylesheet">
    <link href="~/assets/css/style-responsive.css" rel="stylesheet">

    <script src="~/assets/js/chart-master/Chart.js"></script>

    <style>
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #333; 
        }

        .sidebar-toggle-box {
            display: flex;
            align-items: center;
        }

        .top-menu {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-grow: 1;
        }

            .top-menu .nav {
                display: flex;
                align-items: center;
            }

                .top-menu .nav > li {
                    margin-left: 150px; 
                }

            .top-menu .dropdown-toggle {
                display: flex;
                align-items: center;
            }

            .top-menu .logout {
                padding: 10px 15px;
                background-color: #f00; /* Example background color for logout button */
                color: #fff;
                text-decoration: none;
                border-radius: 5px;
            }

        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 1000;
        }

            .dropdown-menu.show {
                display: block;
            }


    </style>
</head>

<body>

    <section id="container">

        <header class="header black-bg">
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars tooltips" data-placement="right"></div>
            </div>
            <div class="top-menu">
                <ul class="nav pull-right top-menu">
                    <li>
                        <div id="header_inbox_bar" class="dropdown">
                            <a id="dropdownToggle" class="dropdown-toggle" href="javascript:void(0);">
                                <i class="fa fa-envelope-o"></i>
                                <span class="badge bg-theme">5</span>
                            </a>
                            <ul id="dropdownMenu" class="dropdown-menu extended inbox">
                                <div class="notify-arrow notify-arrow-green"></div>
                                <li>
                                    <p class="green">You have  new messages</p>
                                </li>
                                <li>

                                    <a href="index.html#">
                                        <span class="subject">
                                            <span class="from">Zac Snider</span>
                                            <span class="time">Just now</span>
                                        </span>
                                        <span class="message">
                                            Hi mate, how is everything?
                                        </span>
                                    </a>
                                </li>
                             
                                <li>
                                    <a href="index.html#">See all messages</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li><a class="logout" href="/Exit/Index">Çıkış</a></li>
                </ul>
            </div>
        </header>


        <!--header end-->
        <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
        <!--sidebar start-->
        <aside>
            <div id="sidebar" class="nav-collapse ">
                <!-- sidebar menu start-->
                <ul class="sidebar-menu" id="nav-accordion">


                    @if (Model.RoleId == "5")
                    {
                        <h5 class="centered">Müdür</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="sub-menu">
                            <a class="active">
                                <i class="fa fa-desktop"></i>
                                <span>Stok Yönetimi</span>
                            </a>

                            <ul class="sub">
                                <li><a href="/Stock/Index">Stok </a></li>
                                <li><a href="/StockMovement/WaitingStatuses">Stok Onay </a></li>
                                <li><a href="/StockMovement/Index">Stok Hareketleri</a></li>
                                <li><a href="/Product/Index">Ürünler</a></li>
                                <li><a href="/Category/Index">Kategoriler</a></li>

                            </ul>
                        </li>
                        <li class="sub-menu">
                            <a href="/WareHouse/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Depo Yönetimi</span>
                            </a>
                        </li>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                    }
                    @if (Model.RoleId == "1")
                    {
                        <h5 class="centered">Admin</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                        <li class="sub-menu">
                            <a href="/User/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Kullanıcı Yönetimi</span>
                            </a>
                        </li>

                        <li class="sub-menu">
                            <a href="/UserRole/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Rol Yönetimi</span>
                            </a>
                        </li>
                    }
                    @if (Model.RoleId == "3")
                    {
                        <h5 class="centered">Satış Elemanı</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/SaleDetails/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Ürün Satış Paneli</span>
                            </a>
                        </li>
                    }

                    @if (Model.RoleId == "2")
                    {
                        <h5 class="centered">Satın Alma</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="mt">
                            <a class="active" href="/Supplier/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Tedarikçiler</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/Demand/WaitingDemands">
                                <i class="fa fa-dashboard"></i>
                                <span>Talep Onay</span>
                            </a>
                        </li>
                        <li class="mt">
                            <a class="active" href="/Demand/ApprovedDemands">
                                <i class="fa fa-dashboard"></i>
                                <span>Onaylanmış Talepler</span>
                            </a>
                        </li>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                    }
                    @if (Model.RoleId == "4")
                    {
                        <h5 class="centered">Depo Sorumlusu</h5>
                        <h5 class="centered">@Model.UserGetDto.Name</h5>

                        <li class="mt">
                            <a class="active" href="/Demand/Index">
                                <i class="fa fa-dashboard"></i>
                                <span>Talep Oluştur</span>
                            </a>
                        </li>

                        <li class="sub-menu">
                            <a class="active">
                                <i class="fa fa-desktop"></i>
                                <span>Stok Yönetimi</span>
                            </a>

                            <ul class="sub">
                                <li><a href="/Stock/Index">Stok </a></li>
                                <li><a href="/Product/Index">Ürünler</a></li>
                                <li><a href="/Category/Index">Kategoriler</a></li>

                            </ul>
                        </li>
                        <li class="sub-menu">
                            <a href="/Chat/Index">
                                <i class="fa fa-cogs"></i>
                                <span>Chat</span>
                            </a>
                        </li>
                    }
                </ul>

            </div>
        </aside>

    </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="~/assets/js/jquery.js"></script>
    <script src="~/assets/js/jquery-1.8.3.min.js"></script>
    <script src="~/assets/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="~/assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="~/assets/js/jquery.scrollTo.min.js"></script>
    <script src="~/assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="~/assets/js/jquery.sparkline.js"></script>


    <!--common script for all pages-->
    <script src="~/assets/js/common-scripts.js"></script>

    <script type="text/javascript" src="~/assets/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="~/assets/js/gritter-conf.js"></script>

    <!--script for this page-->
    <script src="~/assets/js/sparkline-chart.js"></script>
    <script src="~/assets/js/zabuto_calendar.js"></script>

    <script type="application/javascript">

        function myNavFunction(id) {
            $("#date-popover").hide();
            var nav = $("#" + id).data("navigation");
            var to = $("#" + id).data("to");
            console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
        }

    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var dropdownToggle = document.getElementById('dropdownToggle');
            var dropdownMenu = document.getElementById('dropdownMenu');

            if (dropdownToggle && dropdownMenu) {
                dropdownToggle.addEventListener('click', function () {
                    dropdownMenu.classList.toggle('show');
                });

                // Close the dropdown if the user clicks outside of it
                window.addEventListener('click', function (event) {
                    if (!dropdownToggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
                        dropdownMenu.classList.remove('show');
                    }
                });
            }
        });

        $(document).ready(function () {
            // AJAX isteği gönder
            $.ajax({
                url: '/Chat/GetUnreadMessages', 
                method: 'GET',
                success: function (data) {
                  
                    var unreadMessages = data;
                    var unreadCount = unreadMessages.length;

                    // Badge'in metnini güncelleyin
                    $('#header_inbox_bar .badge').text(unreadCount);

                    // Dropdown menüsünü temizleyin
                    var dropdownMenu = $('#dropdownMenu');
                    dropdownMenu.empty();

                    // Yeni mesajları ekleyin
                    if (unreadCount > 0) {
                        dropdownMenu.append('<div class="notify-arrow notify-arrow-green"></div>');
                        dropdownMenu.append('<li><p class="green">You have ' + unreadCount + ' new messages</p></li>');

                        unreadMessages.forEach(function (message) {
                            dropdownMenu.append(
                                '<li>' +
                                '    <a href="index.html#">' +
                                '        <span class="photo"><img alt="avatar" src="assets/img/ui-zac.jpg"></span>' +
                                '        <span class="subject">' +
                                '            <span class="from">' + message.userName + '</span>' +
                                '            <span class="time">' + message.timeSent + '</span>' +
                                '        </span>' +
                                '        <span class="message">' + message.messageText + '</span>' +
                                '    </a>' +
                                '</li>'
                            );
                        });

                        dropdownMenu.append('<li><a href="index.html#">See all messages</a></li>');
                    } else {
                        dropdownMenu.append('<li><p class="green">You have no new messages</p></li>');
                    }
                },
                error: function (error) {
                    console.error('Error fetching unread messages:', error);
                }
            });
        });

    </script>

</body>
</html>
